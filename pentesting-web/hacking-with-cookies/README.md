# Cookies Hacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cookie Attributes

Cookies, kullanÄ±cÄ±nÄ±n tarayÄ±cÄ±sÄ±ndaki davranÄ±ÅŸlarÄ±nÄ± kontrol eden birkaÃ§ Ã¶zellik ile gelir. Ä°ÅŸte bu Ã¶zelliklerin daha pasif bir sesle aÃ§Ä±klamasÄ±:

### Expires and Max-Age

Bir Ã§erezin son kullanma tarihi `Expires` Ã¶zelliÄŸi ile belirlenir. Tersine, `Max-age` Ã¶zelliÄŸi, bir Ã§erezin silinmesine kadar geÃ§en sÃ¼reyi saniye cinsinden tanÄ±mlar. **Daha modern uygulamalarÄ± yansÄ±ttÄ±ÄŸÄ± iÃ§in `Max-age` seÃ§in.**

### Domain

Bir Ã§erezi alacak olan ana bilgisayarlar `Domain` Ã¶zelliÄŸi ile belirtilir. VarsayÄ±lan olarak, bu Ã§erezi veren ana bilgisayara ayarlanÄ±r, alt alan adlarÄ±nÄ± iÃ§ermez. Ancak, `Domain` Ã¶zelliÄŸi aÃ§Ä±kÃ§a ayarlandÄ±ÄŸÄ±nda, alt alan adlarÄ±nÄ± da kapsar. Bu, `Domain` Ã¶zelliÄŸinin belirlenmesini daha az kÄ±sÄ±tlayÄ±cÄ± bir seÃ§enek haline getirir ve alt alan adlarÄ± arasÄ±nda Ã§erez paylaÅŸÄ±mÄ±nÄ±n gerekli olduÄŸu senaryolar iÃ§in faydalÄ±dÄ±r. Ã–rneÄŸin, `Domain=mozilla.org` ayarlandÄ±ÄŸÄ±nda, `developer.mozilla.org` gibi alt alan adlarÄ±nda Ã§erezlere eriÅŸim saÄŸlanÄ±r.

### Path

`Cookie` baÅŸlÄ±ÄŸÄ±nÄ±n gÃ¶nderilmesi iÃ§in istenen URL'de bulunmasÄ± gereken belirli bir URL yolu `Path` Ã¶zelliÄŸi ile belirtilir. Bu Ã¶zellik, `/` karakterini bir dizin ayÄ±rÄ±cÄ± olarak kabul eder ve alt dizinlerde eÅŸleÅŸmelere de izin verir.

### Ordering Rules

Ä°ki Ã§erez aynÄ± adÄ± taÅŸÄ±dÄ±ÄŸÄ±nda, gÃ¶nderilmek Ã¼zere seÃ§ilen Ã§erez:

* Ä°stenen URL'deki en uzun yolu eÅŸleÅŸen Ã§erez.
* Yollar aynÄ±ysa en son ayarlanan Ã§erez.

### SameSite

* `SameSite` Ã¶zelliÄŸi, Ã§erezlerin Ã¼Ã§Ã¼ncÃ¼ taraf alan adlarÄ±ndan gelen isteklere gÃ¶nderilip gÃ¶nderilmeyeceÄŸini belirler. ÃœÃ§ ayar sunar:
* **Strict**: Ã‡erezin Ã¼Ã§Ã¼ncÃ¼ taraf isteklerinde gÃ¶nderilmesini kÄ±sÄ±tlar.
* **Lax**: Ã‡erezin Ã¼Ã§Ã¼ncÃ¼ taraf web siteleri tarafÄ±ndan baÅŸlatÄ±lan GET istekleri ile gÃ¶nderilmesine izin verir.
* **None**: Ã‡erezin herhangi bir Ã¼Ã§Ã¼ncÃ¼ taraf alanÄ±ndan gÃ¶nderilmesine izin verir.

Ã‡erezleri yapÄ±landÄ±rÄ±rken, bu Ã¶zellikleri anlamak, farklÄ± senaryolar arasÄ±nda beklenildiÄŸi gibi davranmalarÄ±nÄ± saÄŸlamaya yardÄ±mcÄ± olabilir.

| **Request Type** | **Example Code**                   | **Cookies Sent When** |
| ---------------- | ---------------------------------- | --------------------- |
| Link             | \<a href="...">\</a>               | NotSet\*, Lax, None   |
| Prerender        | \<link rel="prerender" href=".."/> | NotSet\*, Lax, None   |
| Form GET         | \<form method="GET" action="...">  | NotSet\*, Lax, None   |
| Form POST        | \<form method="POST" action="..."> | NotSet\*, None        |
| iframe           | \<iframe src="...">\</iframe>      | NotSet\*, None        |
| AJAX             | $.get("...")                       | NotSet\*, None        |
| Image            | \<img src="...">                   | NetSet\*, None        |

Tablo [Invicti](https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/) kaynaÄŸÄ±ndan alÄ±nmÄ±ÅŸ ve biraz deÄŸiÅŸtirilmiÅŸtir.\
_**SameSite**_ Ã¶zelliÄŸine sahip bir Ã§erez, **CSRF saldÄ±rÄ±larÄ±nÄ± azaltacaktÄ±r**.

**\*Chrome80 (ÅŸubat/2019) itibarÄ±yla, bir Ã§erez iÃ§in varsayÄ±lan davranÄ±ÅŸ, Ã§erez samesite** **Ã¶zelliÄŸi yoksa lax olacaktÄ±r** ([https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/](https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/)).\
Bu deÄŸiÅŸiklik uygulandÄ±ktan sonra, **SameSite** **politikasÄ± olmayan Ã§erezler Chrome'da** **ilk 2 dakika boyunca None** olarak **deÄŸerlendirilecek ve ardÄ±ndan Ã¼st dÃ¼zey Ã§apraz site POST isteÄŸi iÃ§in Lax olarak deÄŸerlendirilecektir.**

## Cookies Flags

### HttpOnly

Bu, **istemcinin** Ã§ereze eriÅŸimini engeller (Ã–rneÄŸin **Javascript** ile: `document.cookie`)

#### **Bypasses**

* EÄŸer sayfa, bir isteÄŸin yanÄ±tÄ± olarak Ã§erezleri **gÃ¶nderiyorsa** (Ã¶rneÄŸin bir **PHPinfo** sayfasÄ±nda), XSS'i kÃ¶tÃ¼ye kullanarak bu sayfaya bir istek gÃ¶ndermek ve yanÄ±tÄ±ndan **Ã§erezleri Ã§almak** mÃ¼mkÃ¼ndÃ¼r (Ã¶rneÄŸi kontrol edin [https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/](https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/).
* Bu, **TRACE** **HTTP** istekleri ile atlatÄ±labilir Ã§Ã¼nkÃ¼ sunucudan gelen yanÄ±t, gÃ¶nderilen Ã§erezleri yansÄ±tacaktÄ±r (bu HTTP yÃ¶ntemi mevcutsa). Bu teknik **Cross-Site Tracking** olarak adlandÄ±rÄ±lÄ±r.
* Modern tarayÄ±cÄ±lar, JS'den TRACE isteÄŸi gÃ¶ndermeye izin vermeyerek bu tekniÄŸi engeller. Ancak, IE6.0 SP2'ye `TRACE` yerine `\r\nTRACE` gÃ¶ndererek bazÄ± atlatmalar bulunmuÅŸtur.
* DiÄŸer bir yol, tarayÄ±cÄ±larÄ±n sÄ±fÄ±r/gÃ¼nlÃ¼k aÃ§Ä±klarÄ±nÄ± istismar etmektir.
* Bir Ã‡erez Kavanozu taÅŸma saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirerek **HttpOnly Ã§erezlerini** **aÅŸmak** mÃ¼mkÃ¼ndÃ¼r:

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

* Bu Ã§erezleri dÄ±ÅŸarÄ± aktarmak iÃ§in [**Cookie Smuggling**](./#cookie-smuggling) saldÄ±rÄ±sÄ± kullanÄ±labilir.

### Secure

Ä°stek, Ã§erezi yalnÄ±zca gÃ¼venli bir kanal Ã¼zerinden (genellikle **HTTPS**) iletilirse **gÃ¶nderecektir**.

## Cookies Prefixes

`__Secure-` ile baÅŸlayan Ã§erezlerin, HTTPS ile gÃ¼vence altÄ±na alÄ±nmÄ±ÅŸ sayfalardan `secure` bayraÄŸÄ± ile birlikte ayarlanmasÄ± gerekmektedir.

`__Host-` ile baÅŸlayan Ã§erezler iÃ§in birkaÃ§ koÅŸulun karÅŸÄ±lanmasÄ± gerekir:

* `secure` bayraÄŸÄ± ile ayarlanmalÄ±dÄ±r.
* HTTPS ile gÃ¼vence altÄ±na alÄ±nmÄ±ÅŸ bir sayfadan gelmelidir.
* Alt alan adlarÄ±na iletimini engellemek iÃ§in bir alan adÄ± belirtmeleri yasaktÄ±r.
* Bu Ã§erezlerin yolu `/` olarak ayarlanmalÄ±dÄ±r.

`__Host-` ile baÅŸlayan Ã§erezlerin sÃ¼per alan adlarÄ±na veya alt alan adlarÄ±na gÃ¶nderilmesine izin verilmediÄŸini belirtmek Ã¶nemlidir. Bu kÄ±sÄ±tlama, uygulama Ã§erezlerini izole etmeye yardÄ±mcÄ± olur. Bu nedenle, tÃ¼m uygulama Ã§erezleri iÃ§in `__Host-` Ã¶n ekini kullanmak, gÃ¼venliÄŸi ve izolasyonu artÄ±rmak iÃ§in iyi bir uygulama olarak kabul edilebilir.

### Overwriting cookies

DolayÄ±sÄ±yla, `__Host-` ile baÅŸlayan Ã§erezlerin korunmasÄ±ndan biri, alt alan adlarÄ±ndan Ã¼zerine yazÄ±lmalarÄ±nÄ± engellemektir. Ã–rneÄŸin [**Cookie Tossing saldÄ±rÄ±larÄ±nÄ±**](cookie-tossing.md) Ã¶nlemek. [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg) ([**paper**](https://www.usenix.org/system/files/usenixsecurity23-squarcina.pdf)) konuÅŸmasÄ±nda, alt alan adlarÄ±ndan `__HOST-` ile baÅŸlayan Ã§erezlerin ayarlanmasÄ±nÄ±n, Ã¶rneÄŸin baÅŸÄ±na veya sonuna "=" ekleyerek, ayrÄ±ÅŸtÄ±rÄ±cÄ±yÄ± kandÄ±rarak mÃ¼mkÃ¼n olduÄŸu sunulmuÅŸtur:

<figure><img src="../../.gitbook/assets/image (6) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ya da PHP'de Ã§erez adÄ±nÄ±n baÅŸÄ±na **diÄŸer karakterler ekleyerek**, bunlarÄ±n **alt Ã§izgi** karakterleri ile **deÄŸiÅŸtirileceÄŸi** mÃ¼mkÃ¼n olmuÅŸtur, bu da `__HOST-` Ã§erezlerini Ã¼zerine yazmaya izin vermektedir:

<figure><img src="../../.gitbook/assets/image (7) (1) (1) (1).png" alt="" width="373"><figcaption></figcaption></figure>

## Cookies Attacks

Ã–zel bir Ã§erez hassas veriler iÃ§eriyorsa, bunu kontrol edin (Ã¶zellikle bir CTF oynuyorsanÄ±z), Ã§Ã¼nkÃ¼ bu savunmasÄ±z olabilir.

### Decoding and Manipulating Cookies

Ã‡erezlerde gÃ¶mÃ¼lÃ¼ hassas veriler her zaman incelenmelidir. Base64 veya benzeri formatlarda kodlanmÄ±ÅŸ Ã§erezler genellikle Ã§Ã¶zÃ¼lebilir. Bu zafiyet, saldÄ±rganlarÄ±n Ã§erezin iÃ§eriÄŸini deÄŸiÅŸtirmesine ve deÄŸiÅŸtirilmiÅŸ verilerini Ã§ereze geri kodlayarak diÄŸer kullanÄ±cÄ±larÄ± taklit etmesine olanak tanÄ±r.

### Session Hijacking

Bu saldÄ±rÄ±, bir kullanÄ±cÄ±nÄ±n Ã§erezini Ã§alarak uygulama iÃ§indeki hesabÄ±na yetkisiz eriÅŸim saÄŸlamayÄ± iÃ§erir. Ã‡alÄ±nan Ã§erez kullanÄ±larak, bir saldÄ±rgan meÅŸru kullanÄ±cÄ±yÄ± taklit edebilir.

### Session Fixation

Bu senaryoda, bir saldÄ±rgan bir kurbanÄ± belirli bir Ã§erezi kullanarak giriÅŸ yapmaya kandÄ±rÄ±r. Uygulama giriÅŸ yapÄ±ldÄ±ÄŸÄ±nda yeni bir Ã§erez atamazsa, saldÄ±rgan, orijinal Ã§erezi elinde bulundurarak kurbanÄ± taklit edebilir. Bu teknik, kurbanÄ±n saldÄ±rgan tarafÄ±ndan saÄŸlanan bir Ã§erez ile giriÅŸ yapmasÄ±na dayanÄ±r.

EÄŸer bir **alt alan adÄ±nda XSS bulduysanÄ±z** veya **bir alt alan adÄ±nÄ± kontrol ediyorsanÄ±z**, okuyun:

{% content-ref url="cookie-tossing.md" %}
[cookie-tossing.md](cookie-tossing.md)
{% endcontent-ref %}

### Session Donation

Burada, saldÄ±rgan kurbanÄ± saldÄ±rganÄ±n oturum Ã§erezini kullanmaya ikna eder. Kurban, kendi hesabÄ±nda oturum aÃ§tÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nerek, saldÄ±rganÄ±n hesabÄ± baÄŸlamÄ±nda istemeden eylemler gerÃ§ekleÅŸtirir.

EÄŸer bir **alt alan adÄ±nda XSS bulduysanÄ±z** veya **bir alt alan adÄ±nÄ± kontrol ediyorsanÄ±z**, okuyun:

{% content-ref url="cookie-tossing.md" %}
[cookie-tossing.md](cookie-tossing.md)
{% endcontent-ref %}

### [JWT Cookies](../hacking-jwt-json-web-tokens.md)

JWT'deki olasÄ± hatalarÄ± aÃ§Ä±klayan bir sayfaya eriÅŸmek iÃ§in Ã¶nceki baÄŸlantÄ±ya tÄ±klayÄ±n.

Ã‡erezlerde kullanÄ±lan JSON Web Token'lar (JWT) da zafiyetler iÃ§erebilir. Potansiyel hatalar ve bunlarÄ± nasÄ±l istismar edeceÄŸiniz hakkÄ±nda derinlemesine bilgi iÃ§in, JWT'yi hackleme ile ilgili baÄŸlantÄ±lÄ± belgeye eriÅŸmeniz Ã¶nerilir.

### Cross-Site Request Forgery (CSRF)

Bu saldÄ±rÄ±, oturum aÃ§mÄ±ÅŸ bir kullanÄ±cÄ±nÄ±n, ÅŸu anda kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ olduÄŸu bir web uygulamasÄ±nda istenmeyen eylemleri gerÃ§ekleÅŸtirmesini zorlar. SaldÄ±rganlar, savunmasÄ±z siteye her istekte otomatik olarak gÃ¶nderilen Ã§erezleri istismar edebilir.

### Empty Cookies

(BaÅŸka ayrÄ±ntÄ±lar iÃ§in [orijinal araÅŸtÄ±rmaya](https://blog.ankursundara.com/cookie-bugs/) bakÄ±n) TarayÄ±cÄ±lar, isim olmadan Ã§erez oluÅŸturulmasÄ±na izin verir, bu da JavaScript ile ÅŸu ÅŸekilde gÃ¶sterilebilir:
```js
document.cookie = "a=v1"
document.cookie = "=test value;" // Setting an empty named cookie
document.cookie = "b=v2"
```
GÃ¶nderilen Ã§erez baÅŸlÄ±ÄŸÄ±ndaki sonuÃ§ `a=v1; test value; b=v2;` ÅŸeklindedir. Ä°lginÃ§ bir ÅŸekilde, bu, boÅŸ bir isim Ã§erezi ayarlandÄ±ÄŸÄ±nda Ã§erezlerin manipÃ¼le edilmesine olanak tanÄ±r ve boÅŸ Ã§erezi belirli bir deÄŸere ayarlayarak diÄŸer Ã§erezleri potansiyel olarak kontrol etme imkanÄ± saÄŸlar:
```js
function setCookie(name, value) {
document.cookie = `${name}=${value}`;
}

setCookie("", "a=b"); // Setting the empty cookie modifies another cookie's value
```
Bu, tarayÄ±cÄ±nÄ±n her web sunucusu tarafÄ±ndan `a` adÄ±nda ve `b` deÄŸerine sahip bir Ã§erez olarak yorumlanan bir Ã§erez baÅŸlÄ±ÄŸÄ± gÃ¶ndermesine yol aÃ§ar.

#### Chrome HatasÄ±: Unicode Yedek Kod NoktasÄ± Sorunu

Chrome'da, bir Unicode yedek kod noktasÄ± ayarlanmÄ±ÅŸ bir Ã§erezin parÃ§asÄ±ysa, `document.cookie` bozulur ve sonrasÄ±nda boÅŸ bir dize dÃ¶ner:
```js
document.cookie = "\ud800=meep";
```
Bu, `document.cookie`'nin boÅŸ bir dize dÃ¶ndÃ¼rmesine neden olur ve kalÄ±cÄ± bir bozulmayÄ± gÃ¶sterir.

#### AyrÄ±ÅŸtÄ±rma SorunlarÄ±ndan DolayÄ± Cookie Smuggling

(Daha fazla detay iÃ§in [orijinal araÅŸtÄ±rmaya](https://blog.ankursundara.com/cookie-bugs/) bakÄ±n) Java (Jetty, TomCat, Undertow) ve Python (Zope, cherrypy, web.py, aiohttp, bottle, webob) gibi birkaÃ§ web sunucusu, eski RFC2965 desteÄŸi nedeniyle cookie dizelerini yanlÄ±ÅŸ iÅŸler. Birden fazla deÄŸeri ayÄ±rmasÄ± gereken noktalÄ± virgÃ¼ller iÃ§erse bile, Ã§ift tÄ±rnak iÃ§inde bir cookie deÄŸerini tek bir deÄŸer olarak okurlar:
```
RENDER_TEXT="hello world; JSESSIONID=13371337; ASDF=end";
```
#### Cookie Injection Vulnerabilities

(Check further details in the[original research](https://blog.ankursundara.com/cookie-bugs/)) SunucularÄ±n Ã§erezleri yanlÄ±ÅŸ analiz etmesi, Ã¶zellikle Undertow, Zope ve Python'un `http.cookie.SimpleCookie` ve `http.cookie.BaseCookie` kullananlar, Ã§erez enjeksiyon saldÄ±rÄ±larÄ± iÃ§in fÄ±rsatlar yaratÄ±r. Bu sunucular, yeni Ã§erezlerin baÅŸlangÄ±cÄ±nÄ± dÃ¼zgÃ¼n bir ÅŸekilde ayÄ±rt edemez, bu da saldÄ±rganlarÄ±n Ã§erezleri taklit etmesine olanak tanÄ±r:

* Undertow, alÄ±ntÄ±lanmÄ±ÅŸ bir deÄŸerden hemen sonra yeni bir Ã§erez bekler, noktalÄ± virgÃ¼l olmadan.
* Zope, bir sonraki Ã§erezi analiz etmeye baÅŸlamak iÃ§in bir virgÃ¼l arar.
* Python'un Ã§erez sÄ±nÄ±flarÄ±, bir boÅŸluk karakterinde analiz yapmaya baÅŸlar.

Bu zafiyet, Ã§erez tabanlÄ± CSRF korumasÄ±na dayanan web uygulamalarÄ±nda Ã¶zellikle tehlikelidir, Ã§Ã¼nkÃ¼ saldÄ±rganlarÄ±n taklit CSRF-token Ã§erezlerini enjekte etmesine olanak tanÄ±r ve potansiyel olarak gÃ¼venlik Ã¶nlemlerini aÅŸabilir. Sorun, Python'un tekrar eden Ã§erez adlarÄ±nÄ± ele almasÄ±yla daha da kÃ¶tÃ¼leÅŸir; burada son gerÃ§ekleÅŸme Ã¶nceki olanlarÄ± geÃ§ersiz kÄ±lar. AyrÄ±ca, gÃ¼vensiz baÄŸlamlarda `__Secure-` ve `__Host-` Ã§erezleri iÃ§in endiÅŸeleri artÄ±rÄ±r ve Ã§erezlerin taklit edilme eÄŸiliminde olan arka uÃ§ sunuculara iletilmesi durumunda yetkilendirme atlamalarÄ±na yol aÃ§abilir.

### Extra Vulnerable Cookies Checks

#### **Basic checks**

* **Ã‡erez**, her seferinde **aynÄ±dÄ±r** **giriÅŸ yaptÄ±ÄŸÄ±nÄ±zda**.
* Ã‡Ä±kÄ±ÅŸ yapÄ±n ve aynÄ± Ã§erezi kullanmaya Ã§alÄ±ÅŸÄ±n.
* AynÄ± Ã§erezi kullanarak 2 cihazla (veya tarayÄ±cÄ±yla) aynÄ± hesaba giriÅŸ yapmayÄ± deneyin.
* Ã‡erezin iÃ§inde herhangi bir bilgi olup olmadÄ±ÄŸÄ±nÄ± kontrol edin ve deÄŸiÅŸtirmeye Ã§alÄ±ÅŸÄ±n.
* Neredeyse aynÄ± kullanÄ±cÄ± adÄ±yla birkaÃ§ hesap oluÅŸturmaya Ã§alÄ±ÅŸÄ±n ve benzerlikleri gÃ¶rÃ¼p gÃ¶remediÄŸinizi kontrol edin.
* Varsa "**beni hatÄ±rla**" seÃ§eneÄŸini kontrol edin ve nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼n. Varsa ve zayÄ±f olabileceÄŸi dÃ¼ÅŸÃ¼nÃ¼lÃ¼yorsa, her zaman baÅŸka bir Ã§erez olmadan **beni hatÄ±rla** Ã§erezini kullanÄ±n.
* Ã–nceki Ã§erezin, ÅŸifreyi deÄŸiÅŸtirdikten sonra bile Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edin.

#### **Advanced cookies attacks**

Ã‡erez giriÅŸ yaptÄ±ÄŸÄ±nÄ±zda aynÄ± (veya neredeyse aynÄ±) kalÄ±yorsa, bu muhtemelen Ã§erezin hesabÄ±nÄ±zdaki bir alanla (muhtemelen kullanÄ±cÄ± adÄ±yla) iliÅŸkili olduÄŸu anlamÄ±na gelir. O zaman ÅŸunlarÄ± yapabilirsiniz:

* Ã‡ok **benzer** kullanÄ±cÄ± adlarÄ±na sahip birÃ§ok **hesap** oluÅŸturmaya Ã§alÄ±ÅŸÄ±n ve algoritmanÄ±n nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± **tahmin** etmeye Ã§alÄ±ÅŸÄ±n.
* **KullanÄ±cÄ± adÄ±nÄ± brute force** etmeye Ã§alÄ±ÅŸÄ±n. EÄŸer Ã§erez yalnÄ±zca kullanÄ±cÄ± adÄ±nÄ±z iÃ§in bir kimlik doÄŸrulama yÃ¶ntemi olarak kaydediliyorsa, o zaman "**Bmin**" kullanÄ±cÄ± adÄ±yla bir hesap oluÅŸturabilir ve Ã§erezinizin her bir **bitini brute force** edebilirsiniz Ã§Ã¼nkÃ¼ deneyeceÄŸiniz Ã§erezlerden biri "**admin**"e ait olan olacaktÄ±r.
* **Padding** **Oracle** denemesi yapÄ±n (Ã§erezin iÃ§eriÄŸini ÅŸifreleyebilirsiniz). **padbuster** kullanÄ±n.

**Padding Oracle - Padbuster Ã¶rnekleri**
```bash
padbuster <URL/path/when/successfully/login/with/cookie> <COOKIE> <PAD[8-16]>
# When cookies and regular Base64
padbuster http://web.com/index.php u7bvLewln6PJPSAbMb5pFfnCHSEd6olf 8 -cookies auth=u7bvLewln6PJPSAbMb5pFfnCHSEd6olf

# If Base64 urlsafe or hex-lowercase or hex-uppercase --encoding parameter is needed, for example:
padBuster http://web.com/home.jsp?UID=7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6
7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6 8 -encoding 2
```
Padbuster birkaÃ§ deneme yapacak ve sizden hangi durumun hata durumu olduÄŸunu (geÃ§ersiz olan) soracaktÄ±r.

Daha sonra Ã§erezi deÅŸifrelemeye baÅŸlayacaktÄ±r (bu birkaÃ§ dakika sÃ¼rebilir).

EÄŸer saldÄ±rÄ± baÅŸarÄ±yla gerÃ§ekleÅŸtirilmiÅŸse, o zaman seÃ§tiÄŸiniz bir dizeyi ÅŸifrelemeyi deneyebilirsiniz. Ã–rneÄŸin, **encrypt** **user=administrator** istiyorsanÄ±z.
```
padbuster http://web.com/index.php 1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== 8 -cookies thecookie=1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== -plaintext user=administrator
```
Bu yÃ¼rÃ¼tme, iÃ§inde **user=administrator** dizesi bulunan Ã§erezi doÄŸru bir ÅŸekilde ÅŸifrelenmiÅŸ ve kodlanmÄ±ÅŸ olarak verecektir.

**CBC-MAC**

Belki bir Ã§erez bazÄ± deÄŸerlere sahip olabilir ve CBC kullanÄ±larak imzalanabilir. Bu durumda, deÄŸerin bÃ¼tÃ¼nlÃ¼ÄŸÃ¼, aynÄ± deÄŸerle CBC kullanÄ±larak oluÅŸturulan imzadÄ±r. IV olarak sÄ±fÄ±r vektÃ¶rÃ¼ kullanÄ±lmasÄ± Ã¶nerildiÄŸinden, bu tÃ¼r bir bÃ¼tÃ¼nlÃ¼k kontrolÃ¼ savunmasÄ±z olabilir.

**SaldÄ±rÄ±**

1. KullanÄ±cÄ± adÄ± **administ** iÃ§in imzayÄ± al = **t**
2. KullanÄ±cÄ± adÄ± **rator\x00\x00\x00 XOR t** iÃ§in imzayÄ± al = **t'**
3. Ã‡erezde deÄŸeri **administrator+t'** olarak ayarla (**t'**, **(rator\x00\x00\x00 XOR t) XOR t** = **rator\x00\x00\x00** iÃ§in geÃ§erli bir imza olacaktÄ±r)

**ECB**

EÄŸer Ã§erez ECB kullanÄ±larak ÅŸifrelenmiÅŸse, savunmasÄ±z olabilir.\
GiriÅŸ yaptÄ±ÄŸÄ±nÄ±zda aldÄ±ÄŸÄ±nÄ±z Ã§erez her zaman aynÄ± olmalÄ±dÄ±r.

**NasÄ±l tespit edilir ve saldÄ±rÄ±lÄ±r:**

Neredeyse aynÄ± verilere (kullanÄ±cÄ± adÄ±, ÅŸifre, e-posta vb.) sahip 2 kullanÄ±cÄ± oluÅŸturun ve verilen Ã§erez iÃ§inde bir desen keÅŸfetmeye Ã§alÄ±ÅŸÄ±n.

Ã–rneÄŸin "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" adÄ±nda bir kullanÄ±cÄ± oluÅŸturun ve Ã§erezde herhangi bir desen olup olmadÄ±ÄŸÄ±nÄ± kontrol edin (Ã§Ã¼nkÃ¼ ECB her bloÄŸu aynÄ± anahtar ile ÅŸifrelediÄŸinden, kullanÄ±cÄ± adÄ± ÅŸifrelendiÄŸinde aynÄ± ÅŸifrelenmiÅŸ baytlar gÃ¶rÃ¼nebilir).

KullanÄ±lan bir bloÄŸun boyutunda bir desen olmalÄ±dÄ±r. Yani, bir grup "a" nasÄ±l ÅŸifrelendiÄŸini bilerek bir kullanÄ±cÄ± adÄ± oluÅŸturabilirsiniz: "a"*(bloÄŸun boyutu)+"admin". ArdÄ±ndan, Ã§erezden bir "a" bloÄŸunun ÅŸifrelenmiÅŸ desenini silebilirsiniz. Ve "admin" kullanÄ±cÄ± adÄ±nÄ±n Ã§erezine sahip olacaksÄ±nÄ±z.

## Referanslar

* [https://blog.ankursundara.com/cookie-bugs/](https://blog.ankursundara.com/cookie-bugs/)
* [https://www.linkedin.com/posts/rickey-martin-24533653\_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd](https://www.linkedin.com/posts/rickey-martin-24533653\_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
