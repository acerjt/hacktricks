# BROP - Blind Return Oriented Programming

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ÎŸ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± Î¼Ï€Î¿ÏÎ­ÏƒÎ¿Ï…Î¼Îµ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„Î¿ÏÎ¼Îµ Î­Î½Î± ROP Î¼Î­ÏƒÏ‰ Î¼Î¹Î±Ï‚ Ï…Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ·Ï‚ buffer Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î¼Î¯Î± Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î± Î³Î¹Î± Ï„Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ Î´Ï…Î±Î´Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿**.\
Î‘Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ ÎµÎ¾Î®Ï‚ ÏƒÎµÎ½Î¬ÏÎ¹Î¿:

* ÎœÎ¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÏƒÏ„Î¿ stack ÎºÎ±Î¹ Î³Î½ÏÏƒÎ· Ï„Î¿Ï… Ï€ÏÏ‚ Î½Î± Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ.
* ÎœÎ¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® server Ï€Î¿Ï… ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½ÎµÎ¯Ï„Î±Î¹ Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Î¼Î¹Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·.

## Attack

### **1. Î’ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÏ…Î¬Î»Ï‰Ï„Î· Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·** ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î±Î½ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ± Î¼Î­Ï‡ÏÎ¹ Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏ…Î¸ÎµÎ¯ Î¼Î¹Î± Î´Ï…ÏƒÎ»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… server

### **2. Brute-force canary** Î³Î¹Î± Î½Î± Ï„Î¿ Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ

### **3. Brute-force Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ RBP ÎºÎ±Î¹ RIP** ÏƒÏ„Î¿ stack Î³Î¹Î± Î½Î± Ï„Î¹Ï‚ Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚ [ÎµÎ´Ï (BF Forked & Threaded Stack Canaries)](../common-binary-protections-and-bypasses/stack-canaries/bf-forked-stack-canaries.md) ÎºÎ±Î¹ [ÎµÎ´Ï (BF Addresses in the Stack)](../common-binary-protections-and-bypasses/pie/bypassing-canary-and-pie.md).

### **4. Î’ÏÎµÎ¯Ï„Îµ Ï„Î¿ gadget STOP**

Î‘Ï…Ï„ÏŒ Ï„Î¿ gadget ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î²Î±ÏƒÎ¹ÎºÎ¬ Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ ÎºÎ¬Ï„Î¹ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Î·ÎºÎµ Î±Ï€ÏŒ Ï„Î¿ gadget ROP ÎµÏ€ÎµÎ¹Î´Î® Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î´ÎµÎ½ ÎºÎ±Ï„Î­ÏÏÎµÏ…ÏƒÎµ. Î£Ï…Î½Î®Î¸Ï‰Ï‚, Î±Ï…Ï„ÏŒ Ï„Î¿ gadget Î¸Î± ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… **ÏƒÏ„Î±Î¼Î±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·** ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Ï„Î·Ï‚ Î±Î»Ï…ÏƒÎ¯Î´Î±Ï‚ ROP ÏŒÏ„Î±Î½ Î±Î½Î±Î¶Î·Ï„Î¬Î¼Îµ gadgets ROP Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï…Î¼Îµ ÏŒÏ„Î¹ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Î·ÎºÎµ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ gadget ROP.

### **5. Î’ÏÎµÎ¯Ï„Îµ Ï„Î¿ gadget BROP**

Î‘Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ [**ret2csu**](ret2csu.md) gadget. ÎšÎ±Î¹ Î±Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î® Î±Î½ Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ gadget ÏƒÏ„Î· Î¼Î­ÏƒÎ· ÎºÎ¬Ï€Î¿Î¹Ï‰Î½ ÎµÎ½Ï„Î¿Î»ÏÎ½, Î±Ï€Î¿ÎºÏ„Î¬Ï„Îµ gadgets Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ **`rsi`** ÎºÎ±Î¹ **`rdi`**:

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt="" width="278"><figcaption><p><a href="https://www.scs.stanford.edu/brop/bittau-brop.pdf">https://www.scs.stanford.edu/brop/bittau-brop.pdf</a></p></figcaption></figure>

Î‘Ï…Ï„Î¬ Î¸Î± ÎµÎ¯Î½Î±Î¹ Ï„Î± gadgets:

* `pop rsi; pop r15; ret`
* `pop rdi; ret`

Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÏ„Îµ Ï€ÏÏ‚ Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± gadgets ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ 2 Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚** Î¼Î¹Î±Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¸Î± ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ.

Î•Ï€Î¯ÏƒÎ·Ï‚, Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ gadget ret2csu Î­Ï‡ÎµÎ¹ Î¼Î¹Î± **Ï€Î¿Î»Ï Î¼Î¿Î½Î±Î´Î¹ÎºÎ® Ï…Ï€Î¿Î³ÏÎ±Ï†Î®** ÎµÏ€ÎµÎ¹Î´Î® Î¸Î± popÎ¬ÏÎµÎ¹ 6 ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Ï„Î­Ï‚ Î±Ï€ÏŒ Ï„Î¿ stack. ÎˆÏ„ÏƒÎ¹, ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î¼Î¹Î± Î±Î»Ï…ÏƒÎ¯Î´Î± ÏŒÏ€Ï‰Ï‚:

`'A' * offset + canary + rbp + ADDR + 0xdead * 6 + STOP`

Î‘Î½ Ï„Î¿ **STOP ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹**, Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î²Î±ÏƒÎ¹ÎºÎ¬ ÏŒÏ„Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î¼Î¹Î± **Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï€Î¿Ï… popÎ¬ÏÎµÎ¹ 6 ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Ï„Î­Ï‚** Î±Ï€ÏŒ Ï„Î¿ stack. Î‰ ÏŒÏ„Î¹ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î®Ï„Î±Î½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· STOP.

Î“Î¹Î± Î½Î± **Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯ Î±Ï…Ï„Î® Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÏ€Î¹Î»Î¿Î³Î®**, ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î¹Î± Î½Î­Î± Î±Î»Ï…ÏƒÎ¯Î´Î± ÏŒÏ€Ï‰Ï‚ Î· ÎµÎ¾Î®Ï‚ ÎºÎ±Î¹ Î´ÎµÎ½ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿ gadget STOP Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ popÎ¬ÏÎ¹ÏƒÎµ 6 ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Ï„Î­Ï‚:

`'A' * offset + canary + rbp + ADDR`

Î“Î½Ï‰ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… gadget ret2csu, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± **ÏƒÏ…Î¼Ï€ÎµÏÎ¬Î½Î¿Ï…Î¼Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Ï‰Î½ gadgets Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾Î¿Ï…Î¼Îµ `rsi` ÎºÎ±Î¹ `rdi`**.

### 6. Î’ÏÎµÎ¯Ï„Îµ Ï„Î¿ PLT

ÎŸ Ï€Î¯Î½Î±ÎºÎ±Ï‚ PLT Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¶Î·Ï„Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ 0x400000 Î® Î±Ï€ÏŒ Ï„Î· **Î´Î¹ÎµÏ…Î¸Ï…Î½ÏƒÎ· RIP Ï€Î¿Ï… Î´Î¹Î±ÏÏÎ­ÎµÎ¹** Î±Ï€ÏŒ Ï„Î¿ stack (Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ **PIE**). ÎŸÎ¹ **ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚** Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÎµÎ¯Î½Î±Î¹ **Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÎºÎ±Ï„Î¬ 16B** (0x10B), ÎºÎ±Î¹ ÏŒÏ„Î±Î½ ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·, Î¿ server Î´ÎµÎ½ ÎºÎ±Ï„Î±ÏÏÎ­ÎµÎ¹ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Î½ Î¿Î¹ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Î¹ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¿Î¯. Î•Ï€Î¯ÏƒÎ·Ï‚, Î· Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ Î¼Î¹Î±Ï‚ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚ ÏƒÏ„Î¿ **PLT + 6B ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´ÎµÎ½ ÎºÎ±Ï„Î±ÏÏÎ­ÎµÎ¹** ÎºÎ±Î¸ÏÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ Ï€ÏÏÏ„Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹.

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± PLT ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Ï‚ Ï„Î¹Ï‚ ÎµÎ¾Î®Ï‚ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ­Ï‚:

* `'A' * offset + canary + rbp + ADDR + STOP` -> ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* `'A' * offset + canary + rbp + (ADDR + 0x6) + STOP` -> ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* `'A' * offset + canary + rbp + (ADDR + 0x10) + STOP` -> ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·

### 7. Î•ÏÏÎµÏƒÎ· strcmp

Î— ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· **`strcmp`** ÏÏ…Î¸Î¼Î¯Î¶ÎµÎ¹ Ï„Î¿Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Ï„Î® **`rdx`** ÏƒÏ„Î¿ Î¼Î®ÎºÎ¿Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ Ï€Î¿Ï… ÏƒÏ…Î³ÎºÏÎ¯Î½ÎµÏ„Î±Î¹. Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **`rdx`** ÎµÎ¯Î½Î±Î¹ Î· **Ï„ÏÎ¯Ï„Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚** ÎºÎ±Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ **Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î±Ï€ÏŒ 0** Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î±ÏÎ³ÏŒÏ„ÎµÏÎ± Ï„Î¿ `write` Î³Î¹Î± Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Ï„Î·Ï‚ **`strcmp`** ÏƒÏ„Î¿Î½ PLT Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Ï„Î·Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î³ÎµÎ³Î¿Î½ÏŒÏ‚ ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Ï„ÏÏÎ± Î½Î± ÎµÎ»Î­Î³Î¾Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ 2 Ï€ÏÏÏ„ÎµÏ‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½:

* strcmp(\<non read addr>, \<non read addr>) -> ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* strcmp(\<non read addr>, \<read addr>) -> ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* strcmp(\<read addr>, \<non read addr>) -> ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* strcmp(\<read addr>, \<read addr>) -> ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Ï…Ï„ÏŒ ÎºÎ±Î»ÏÎ½Ï„Î±Ï‚ ÎºÎ¬Î¸Îµ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± PLT Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **PLT slow path** Ï€Î¿Ï… Î²Î±ÏƒÎ¹ÎºÎ¬ ÏƒÏ…Î½Î¯ÏƒÏ„Î±Ï„Î±Î¹ ÏƒÏ„Î¿ **Î½Î± ÎºÎ±Î»ÎµÎ¯Ï„Îµ Î¼Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± PLT + 0xb** (Î· Î¿Ï€Î¿Î¯Î± ÎºÎ±Î»ÎµÎ¯ Ï„Î¿ **`dlresolve`**) Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ¼ÎµÎ½Î· ÏƒÏ„Î¿ stack Î±Ï€ÏŒ Ï„Î¿Î½ **Î±ÏÎ¹Î¸Î¼ÏŒ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ** (Î¾ÎµÎºÎ¹Î½ÏÎ½Ï„Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½) Î³Î¹Î± Î½Î± ÏƒÎ±ÏÏÏƒÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ PLT Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÏÏ„Î·:

* strcmp(\<non read addr>, \<read addr>) -> ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0x300) + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP` -> Î˜Î± ÎºÎ±Ï„Î±ÏÏÎµÏÏƒÎµÎ¹
* strcmp(\<read addr>, \<non read addr>) -> ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* `b'A' * offset + canary + rbp + (BROP + 0x9) + p64(0x300) + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP`
* strcmp(\<read addr>, \<read addr>) -> ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î¬ÏÏÎµÏ…ÏƒÎ·
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP`

Î˜Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹:

* BROP + 0x7 Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ **`pop RSI; pop R15; ret;`**
* BROP + 0x9 Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ **`pop RDI; ret;`**
* PLT + 0xb Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÎµ Î¼Î¹Î± ÎºÎ»Î®ÏƒÎ· ÏƒÏ„Î¿ **dl\_resolve**.

Î‘Ï†Î¿Ï Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ `strcmp`, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Ï„Î¿ **`rdx`** ÏƒÎµ Î¼Î¹Î± Ï„Î¹Î¼Î® Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î±Ï€ÏŒ 0.

{% hint style="success" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï„Î¿ `rdx` Î¸Î± Ï†Î¹Î»Î¿Î¾ÎµÎ½ÎµÎ¯ Î®Î´Î· Î¼Î¹Î± Ï„Î¹Î¼Î® Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î±Ï€ÏŒ 0, Î¿Ï€ÏŒÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î®Î¼Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼Î·Î½ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿.
{% endhint %}

### 8. Î•ÏÏÎµÏƒÎ· Write Î® Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿Ï…

Î¤Î­Î»Î¿Ï‚, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î­Î½Î± gadget Ï€Î¿Ï… Î½Î± ÎµÎ¾Î¬Î³ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± ÎµÎ¾Î¬Î³ÎµÎ¹ Ï„Î¿ Î´Ï…Î±Î´Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿. ÎšÎ±Î¹ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ 2 Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Ï„Î¿ `rdx` Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î±Ï€ÏŒ 0.**

Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ 3 ÎºÎ¿Î¹Î½Î­Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„Î¿ÏÎ½ Î³Î¹Î± Î±Ï…Ï„ÏŒ:

* `puts(data)`
* `dprintf(fd, data)`
* `write(fd, data, len(data)`

Î©ÏƒÏ„ÏŒÏƒÎ¿, Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î­Î³Î³ÏÎ±Ï†Î¿ Î±Î½Î±Ï†Î­ÏÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î· **ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `write`**, Î¿Ï€ÏŒÏ„Îµ Î±Ï‚ Î¼Î¹Î»Î®ÏƒÎ¿Ï…Î¼Îµ Î³Î¹' Î±Ï…Ï„Î®Î½:

Î¤Î¿ Ï„ÏÎ­Ï‡Î¿Î½ Ï€ÏÏŒÎ²Î»Î·Î¼Î± ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ Î´ÎµÎ½ Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ **Ï€Î¿Ï Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· write Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ PLT** ÎºÎ±Î¹ Î´ÎµÎ½ Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ **Î­Î½Î±Î½ Î±ÏÎ¹Î¸Î¼ÏŒ fd Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»Î¿Ï…Î¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÏ„Î· ÏƒÏÎ½Î´ÎµÏƒÎ® Î¼Î±Ï‚**.

Î©ÏƒÏ„ÏŒÏƒÎ¿, Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ **Ï€Î¿Ï ÎµÎ¯Î½Î±Î¹ Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ PLT** ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï„Î· write Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î· **ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬** Ï„Î·Ï‚. ÎšÎ±Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ **Ï€Î¿Î»Î»Î­Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚** Î¼Îµ Ï„Î¿Î½ server ÎºÎ±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î±Î½ **Ï…ÏˆÎ·Î»ÏŒ FD** ÎµÎ»Ï€Î¯Î¶Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ Î¸Î± Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹ Î¼Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î¼Î±Ï‚.

Î¥Ï€Î¿Î³ÏÎ±Ï†Î­Ï‚ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬Ï‚ Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚:

* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0) + p64(0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> Î‘Î½ ÎµÎºÏ„Ï…Ï€Ï‰Î¸Î¿ÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„ÏŒÏ„Îµ Î²ÏÎ­Î¸Î·ÎºÎµ Î· puts
* `'A' * offset + canary + rbp + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> Î‘Î½ ÎµÎºÏ„Ï…Ï€Ï‰Î¸Î¿ÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„ÏŒÏ„Îµ Î²ÏÎ­Î¸Î·ÎºÎµ Î· dprintf
* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + (RIP + 0x1) + p64(0x0) + (PLT + 0xb ) + p64(STRCMP ENTRY) + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> Î‘Î½ ÎµÎºÏ„Ï…Ï€Ï‰Î¸Î¿ÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„ÏŒÏ„Îµ Î²ÏÎ­Î¸Î·ÎºÎµ Î· write

## Automatic Exploitation

* [https://github.com/Hakumarachi/Bropper](https://github.com/Hakumarachi/Bropper)

## References

* Original paper: [https://www.scs.stanford.edu/brop/bittau-brop.pdf](https://www.scs.stanford.edu/brop/bittau-brop.pdf)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop](https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
